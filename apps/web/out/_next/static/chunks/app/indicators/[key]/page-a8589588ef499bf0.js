(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{7221:function(e,t,n){Promise.resolve().then(n.bind(n,3241))},5429:function(e,t,n){"use strict";n.d(t,{J:function(){return l}});var a=n(7437),s=n(2265),r=n(6530),i=n(6264);function l(e){let{indicatorKey:t,compact:n=!1}=e,{t:l,locale:c}=(0,r.b)(),[o,u]=(0,s.useState)(null),[d,x]=(0,s.useState)("30d"),[h,m]=(0,s.useState)(!0),[f,p]=(0,s.useState)(null),[g,b]=(0,s.useState)(null);(0,s.useEffect)(()=>{t&&(m(!0),p(null),(0,i.cS)(t,d,"1d").then(u).catch(e=>p(e.message)).finally(()=>m(!1)))},[t,d]);let y="es"===c?"es":"en",v=(0,s.useCallback)(e=>new Date(e).toLocaleDateString(y,{month:"short",day:"numeric"}),[y]),j=(0,s.useCallback)(e=>new Date(e).toLocaleDateString(y,{day:"numeric",month:"numeric"}),[y]);if(!t)return null;if(h)return(0,a.jsx)("div",{className:n?"py-4 text-sm text-gray-500":"p-8 text-gray-500",children:l("common.loading")});if(f)return(0,a.jsxs)("div",{className:n?"py-4 text-sm text-red-600":"p-8 text-red-600",children:[l("common.error"),": ",f]});let N=(null==o?void 0:o.data)||[],w=Math.max(...N.map(e=>e.value),1),S=Math.min(...N.map(e=>e.value),0),C=w-S||1,k=[w,S+.5*C,S].filter((e,t,n)=>n.indexOf(e)===t),E=Math.max(1,Math.floor(N.length/5)),D=N.length>14?j:v;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"mb-2 flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>x("30d"),className:"px-3 py-1 rounded text-sm ".concat("30d"===d?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:l("indicatorsDetail.period30")}),(0,a.jsx)("button",{type:"button",onClick:()=>x("90d"),className:"px-3 py-1 rounded text-sm ".concat("90d"===d?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:l("indicatorsDetail.period90")})]}),0===N.length?(0,a.jsxs)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-4 text-amber-800",children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:l("indicatorsDetail.noHistory")}),(0,a.jsx)("p",{className:"mt-1 text-xs",children:l("indicatorsDetail.noHistoryHint")})]}):(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-white relative",children:[(0,a.jsxs)("div",{className:"flex gap-2 ".concat(n?"h-40":"h-56"),children:[(0,a.jsx)("div",{className:"flex flex-col justify-between text-right text-xs text-gray-500 pr-2 shrink-0",children:k.map(e=>(0,a.jsx)("span",{children:"number"==typeof e&&e%1!=0?e.toFixed(2):e},e))}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,a.jsx)("div",{className:"flex items-end gap-px flex-1 relative",children:N.map(e=>(0,a.jsx)("div",{className:"flex-1 bg-blue-500 rounded-t min-w-0",style:{height:"".concat(w===S?100:(e.value-S)/C*100,"%")},onMouseEnter:t=>{let n=t.currentTarget.getBoundingClientRect();b({point:e,x:n.left+n.width/2,y:n.top})},onMouseLeave:()=>b(null)},e.ts))}),(0,a.jsx)("div",{className:"flex text-xs text-gray-500 mt-1 gap-px",children:N.map((e,t)=>(0,a.jsx)("span",{className:"flex-1 min-w-0 text-center",style:{flex:1},children:t%E==0?D(e.ts):""},e.ts))})]})]}),g&&(0,a.jsxs)("div",{className:"fixed z-50 px-2 py-1 text-xs font-medium bg-gray-800 text-white rounded shadow-lg pointer-events-none",style:{left:g.x,top:g.y-32,transform:"translate(-50%, 0)"},children:[v(g.point.ts),": ",g.point.value]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:l("indicatorsDetail.chartHint")})]})]})}},8706:function(e,t,n){"use strict";n.d(t,{l:function(){return o}});var a=n(7437),s=n(2265),r=n(7138),i=n(6463),l=n(6530),c=n(6881);function o(){let{t:e,locale:t,setLocale:n}=(0,l.b)(),o=(0,i.useRouter)(),[u,d]=(0,s.useState)(null);async function x(){await (0,c.M)().auth.signOut(),o.push("/login"),o.refresh()}return(0,s.useEffect)(()=>{(0,c.M)().auth.getSession().then(e=>{let{data:{session:t}}=e;return d(!!t)});let{data:{subscription:e}}=(0,c.M)().auth.onAuthStateChange(()=>{(0,c.M)().auth.getSession().then(e=>{let{data:{session:t}}=e;return d(!!t)})});return()=>e.unsubscribe()},[]),(0,a.jsxs)("nav",{className:"mb-8 flex flex-wrap items-center gap-4",children:[!0===u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.default,{href:"/dashboard",className:"text-blue-600 hover:underline",children:e("nav.dashboard")}),(0,a.jsx)(r.default,{href:"/indicators",className:"text-blue-600 hover:underline",children:e("nav.indicators")}),(0,a.jsx)(r.default,{href:"/alerts",className:"text-blue-600 hover:underline",children:e("nav.alerts")}),(0,a.jsx)("button",{type:"button",onClick:x,className:"text-blue-600 hover:underline ml-auto",children:e("nav.logout")})]}),(!1===u||null===u)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.default,{href:"/login",className:"text-blue-600 hover:underline",children:e("nav.login")}),(0,a.jsx)(r.default,{href:"/signup",className:"text-blue-600 hover:underline",children:e("nav.signup")}),(0,a.jsx)("span",{className:"ml-auto"})]}),(0,a.jsxs)("span",{className:"ml-auto flex gap-2 text-sm",children:[(0,a.jsx)("button",{type:"button",onClick:()=>n("es"),className:"es"===t?"font-semibold text-blue-600 underline":"text-gray-600 hover:text-blue-600","aria-pressed":"es"===t,children:"ES"}),(0,a.jsx)("span",{className:"text-gray-400","aria-hidden":!0,children:"|"}),(0,a.jsx)("button",{type:"button",onClick:()=>n("en"),className:"en"===t?"font-semibold text-blue-600 underline":"text-gray-600 hover:text-blue-600","aria-pressed":"en"===t,children:"EN"})]})]})}},3241:function(e,t,n){"use strict";n.d(t,{IndicatorDetailClient:function(){return l}});var a=n(7437),s=n(8706),r=n(5429),i=n(6530);function l(e){let{keyParam:t}=e,{t:n}=(0,i.b)();if(!t)return null;let l="dashboard.indicatorShortLabel."+t,c=n(l)!==l?n(l):t;return(0,a.jsxs)("main",{className:"min-h-screen p-8 max-w-4xl mx-auto",children:[(0,a.jsx)(s.l,{}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:c}),(0,a.jsx)(r.J,{indicatorKey:t,compact:!1})]})}},6264:function(e,t,n){"use strict";var a;n.d(t,{AK:function(){return i},JB:function(){return d},Oj:function(){return c},cS:function(){return l},hE:function(){return o},j:function(){return u}});let s=null!==(a=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==a?a:"";async function r(e){if(e.ok)return;let t=await e.text(),n=t||e.statusText;try{let e=JSON.parse(t);"string"==typeof(null==e?void 0:e.error)&&(n=e.error)}catch(e){}throw Error(n)}async function i(e){let t=e?"?timezone=".concat(encodeURIComponent(e)):"",n=await fetch("".concat(s,"/api/dashboard/today").concat(t));return await r(n),n.json()}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"30d",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1d",a=await fetch("".concat(s,"/api/indicators/").concat(encodeURIComponent(e),"/history?range=").concat(t,"&granularity=").concat(n));return await r(a),a.json()}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"12w",t=await fetch("".concat(s,"/api/score/history?range=").concat(e));return await r(t),t.json()}async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"30d",t=await fetch("".concat(s,"/api/alerts/history?range=").concat(e));return await r(t),t.json()}async function u(){let e=await fetch("".concat(s,"/api/rules"));return await r(e),e.json()}async function d(e){let t={};e&&(t["X-Cron-Secret"]=e);let n=await fetch("".concat("","/.netlify/functions/run-jobs"),{method:"POST",headers:t});if(401===n.status)throw Error("Cron secret required. Set CRON_SECRET in Netlify and enter it when prompted.");return await r(n),n.json().catch(()=>({ok:!0}))}}},function(e){e.O(0,[497,138,836,971,23,744],function(){return e(e.s=7221)}),_N_E=e.O()}]);