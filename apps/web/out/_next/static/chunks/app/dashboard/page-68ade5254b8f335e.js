(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{9140:function(e,t,a){Promise.resolve().then(a.bind(a,4591))},8706:function(e,t,a){"use strict";a.d(t,{l:function(){return i}});var s=a(7437),r=a(2265),n=a(7138),l=a(6463),d=a(6530),o=a(6881);function i(){let{t:e,locale:t,setLocale:a}=(0,d.b)(),i=(0,l.useRouter)(),[c,m]=(0,r.useState)(null);async function x(){await (0,o.M)().auth.signOut(),i.push("/login"),i.refresh()}return(0,r.useEffect)(()=>{(0,o.M)().auth.getSession().then(e=>{let{data:{session:t}}=e;return m(!!t)});let{data:{subscription:e}}=(0,o.M)().auth.onAuthStateChange(()=>{(0,o.M)().auth.getSession().then(e=>{let{data:{session:t}}=e;return m(!!t)})});return()=>e.unsubscribe()},[]),(0,s.jsxs)("nav",{className:"mb-8 flex flex-wrap items-center gap-4",children:[!0===c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.default,{href:"/dashboard",className:"text-blue-600 hover:underline",children:e("nav.dashboard")}),(0,s.jsx)(n.default,{href:"/indicators",className:"text-blue-600 hover:underline",children:e("nav.indicators")}),(0,s.jsx)(n.default,{href:"/alerts",className:"text-blue-600 hover:underline",children:e("nav.alerts")}),(0,s.jsx)("button",{type:"button",onClick:x,className:"text-blue-600 hover:underline ml-auto",children:e("nav.logout")})]}),(!1===c||null===c)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.default,{href:"/login",className:"text-blue-600 hover:underline",children:e("nav.login")}),(0,s.jsx)(n.default,{href:"/signup",className:"text-blue-600 hover:underline",children:e("nav.signup")}),(0,s.jsx)("span",{className:"ml-auto"})]}),(0,s.jsxs)("span",{className:"ml-auto flex gap-2 text-sm",children:[(0,s.jsx)("button",{type:"button",onClick:()=>a("es"),className:"es"===t?"font-semibold text-blue-600 underline":"text-gray-600 hover:text-blue-600","aria-pressed":"es"===t,children:"ES"}),(0,s.jsx)("span",{className:"text-gray-400","aria-hidden":!0,children:"|"}),(0,s.jsx)("button",{type:"button",onClick:()=>a("en"),className:"en"===t?"font-semibold text-blue-600 underline":"text-gray-600 hover:text-blue-600","aria-pressed":"en"===t,children:"EN"})]})]})}},4591:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(7437),r=a(2265),n=a(7138),l=a(8706),d=a(6530),o=a(6264);function i(){return Promise.all([(0,o.AK)(),(0,o.Oj)("12w")])}function c(){let{t:e,translateExplain:t,locale:a}=(0,d.b)(),[c,m]=(0,r.useState)(null),[x,h]=(0,r.useState)([]),[u,b]=(0,r.useState)(!0),[p,g]=(0,r.useState)(null),[f,j]=(0,r.useState)(!1),[y,N]=(0,r.useState)(null),[v,w]=(0,r.useState)(!1),[k,S]=(0,r.useState)(""),[E,L]=(0,r.useState)(null),[C,R]=(0,r.useState)(null),[H,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{i().then(e=>{let[t,a]=e;m(t),h(a.data||[])}).catch(e=>g(e.message)).finally(()=>b(!1))},[]);let _=(0,r.useCallback)(async e=>{N(null),j(!0);try{await (0,o.JB)(e),w(!1),S("");let[t,a]=await i();m(t),h(a.data||[]),g(null)}catch(t){let e=t instanceof Error?t.message:String(t);e.includes("Cron secret required")?w(!0):N(e)}finally{j(!1)}},[]);if(u)return(0,s.jsx)("div",{className:"p-8",children:e("common.loading")});if(p)return(0,s.jsxs)("main",{className:"min-h-screen p-8 max-w-6xl mx-auto",children:[(0,s.jsx)(l.l,{}),(0,s.jsxs)("div",{className:"mb-4 text-red-600",children:[e("common.error"),": ",p]}),(0,s.jsx)("p",{className:"mb-4 text-sm text-gray-600",children:e("dashboard.errorHint")}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>_(),disabled:f,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:f?e("dashboard.running"):e("dashboard.runJobs")}),y&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:y})]}),v&&(0,s.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-2 rounded-lg border border-amber-200 bg-amber-50 p-3 text-amber-800",children:[(0,s.jsx)("label",{htmlFor:"cron-secret-err",className:"text-sm font-medium",children:e("dashboard.cronSecretLabel")}),(0,s.jsx)("input",{id:"cron-secret-err",type:"password",value:k,onChange:e=>S(e.target.value),placeholder:e("dashboard.cronSecretPlaceholder"),className:"rounded border border-amber-300 px-2 py-1 text-sm"}),(0,s.jsx)("button",{type:"button",onClick:()=>_(k),disabled:f||!k.trim(),className:"rounded bg-amber-600 px-3 py-1 text-sm text-white hover:bg-amber-700 disabled:opacity-50",children:e("dashboard.runWithSecret")})]})]});if(!c)return null;let M=e=>"GREEN"===e?"text-green-600":"RED"===e?"text-red-600":"YELLOW"===e?"text-amber-500":"text-gray-400",W=e=>"RISING"===e?"↑":"FALLING"===e?"↓":"→";return(0,s.jsxs)("main",{className:"min-h-screen p-8 max-w-6xl mx-auto",children:[(0,s.jsx)(l.l,{}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:e("dashboard.title")}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e("dashboard.asOf"),": ",new Date(c.asOf).toLocaleString()]}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-0.5",children:e("dashboard.refreshHint")})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>_(),disabled:f,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:f?e("dashboard.running"):e("dashboard.runJobs")}),y&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:y})]})]}),v&&(0,s.jsxs)("div",{className:"mb-6 flex flex-wrap items-center gap-2 rounded-lg border border-amber-200 bg-amber-50 p-3 text-amber-800",children:[(0,s.jsx)("label",{htmlFor:"cron-secret",className:"text-sm font-medium",children:e("dashboard.cronSecretLabel")}),(0,s.jsx)("input",{id:"cron-secret",type:"password",value:k,onChange:e=>S(e.target.value),placeholder:e("dashboard.cronSecretPlaceholder"),className:"rounded border border-amber-300 px-2 py-1 text-sm"}),(0,s.jsx)("button",{type:"button",onClick:()=>_(k),disabled:f||!k.trim(),className:"rounded bg-amber-600 px-3 py-1 text-sm text-white hover:bg-amber-700 disabled:opacity-50",children:e("dashboard.runWithSecret")}),(0,s.jsx)("button",{type:"button",onClick:()=>{w(!1),N(null)},className:"text-sm underline",children:e("dashboard.cancel")})]}),(0,s.jsxs)("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow-sm relative",onMouseEnter:()=>R("weeklyScore"),onMouseLeave:()=>R(null),children:[(0,s.jsx)("h2",{className:"text-sm font-medium text-gray-500",children:e("dashboard.weeklyScore")}),(0,s.jsx)("p",{className:"text-3xl font-bold",children:c.score}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[e("dashboard.deltaWeek"),": ",c.deltaWeek>=0?"+":"",c.deltaWeek]}),(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-500 mb-1.5",children:e("dashboard.weeklyScoreBreakdown")}),(0,s.jsx)("p",{className:"text-[11px] text-gray-500 mb-2",children:e("dashboard.weeklyScoreBreakdownHint")}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-[11px]",children:[["GREEN","YELLOW","RED"].map(t=>{let a=c.indicators.filter(e=>e.status===t);if(0===a.length)return null;let r="GREEN"===t?"scoreStatusGreen":"YELLOW"===t?"scoreStatusYellow":"scoreStatusRed",n=a.map(t=>{let a="dashboard.indicatorShortLabel."+t.key,s=e(a);return s!==a?s:t.key});return(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"font-medium ".concat(M(t)),children:e("dashboard."+r)}),(0,s.jsxs)("span",{className:"text-gray-600",children:["(",a.length,"): ",n.join(", ")]})]},t)}),c.indicators.some(e=>"GREEN"!==e.status&&"YELLOW"!==e.status&&"RED"!==e.status)&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"font-medium text-gray-400",children:e("dashboard.scoreStatusUnknown")}),(0,s.jsxs)("span",{className:"text-gray-600",children:["(",c.indicators.filter(e=>"GREEN"!==e.status&&"YELLOW"!==e.status&&"RED"!==e.status).length,"):"," ",c.indicators.filter(e=>"GREEN"!==e.status&&"YELLOW"!==e.status&&"RED"!==e.status).map(t=>e("dashboard.indicatorShortLabel."+t.key)!=="dashboard.indicatorShortLabel."+t.key?e("dashboard.indicatorShortLabel."+t.key):t.key).join(", ")]})]})]})]}),"weeklyScore"===C&&(0,s.jsx)("div",{className:"absolute z-20 left-0 right-0 bottom-full mb-1 p-3 text-xs text-left bg-gray-800 text-white rounded-lg shadow-lg pointer-events-none max-w-xs",children:e("dashboard.weeklyScoreTooltip")})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow-sm relative",onMouseEnter:()=>R("scoreHistory"),onMouseLeave:()=>{R(null),O(null)},children:[(0,s.jsx)("h2",{className:"text-sm font-medium text-gray-500",children:e("dashboard.scoreHistory")}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-0.5",children:e("dashboard.scoreHistoryRange")}),"scoreHistory"===C&&(0,s.jsxs)("div",{className:"absolute z-20 left-0 right-0 bottom-full mb-1 p-3 text-xs text-left bg-gray-800 text-white rounded-lg shadow-lg pointer-events-none max-w-sm",children:[(0,s.jsx)("p",{className:"mb-1",children:e("dashboard.scoreHistoryCaption")}),(0,s.jsx)("p",{className:"mb-1",children:e("dashboard.scoreHistoryWhatItIs")}),(0,s.jsx)("p",{children:e("dashboard.scoreHistoryHowToInterpret")})]}),0===x.length?(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:e("dashboard.scoreHistoryEmpty")}):(0,s.jsxs)("div",{className:"flex gap-1 h-28 mt-2 items-end",children:[(0,s.jsxs)("div",{className:"flex flex-col justify-between text-right text-xs text-gray-500 pr-1 shrink-0 h-full",children:[(0,s.jsx)("span",{children:"8"}),(0,s.jsx)("span",{children:"4"}),(0,s.jsx)("span",{children:"0"})]}),(0,s.jsx)("div",{className:"flex-1 flex gap-0.5 min-w-0 h-full",children:x.slice(-12).map(t=>{let a=Number(t.score);return(0,s.jsxs)("div",{className:"flex-1 flex flex-col justify-end items-center min-w-0 h-full cursor-default",onMouseEnter:()=>O(t),onMouseLeave:()=>O(null),title:"".concat(e("dashboard.scoreHistoryHoverLabel")," ").concat(t.week_start_date," → ").concat(t.score),children:[(0,s.jsx)("span",{className:"text-[10px] font-medium text-gray-600 mb-0.5 leading-none","aria-hidden":"true",children:t.score}),(0,s.jsx)("div",{className:"w-full ".concat(a>=5?"bg-green-500":a>=3?"bg-amber-500":a>=1?"bg-red-400":"bg-gray-300"," rounded-t min-h-[2px]"),style:{height:"".concat(Math.max(10,Math.min(100,a/8*100)),"%")}})]},t.week_start_date)})})]})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[(0,s.jsx)("h2",{className:"text-sm font-medium text-gray-500",children:e("dashboard.scenario")}),(0,s.jsxs)("p",{className:"font-medium",children:[e("dashboard.bull"),": ",e("dashboard.scenarioValue.bull."+c.scenario.bull)]}),(0,s.jsxs)("p",{className:"font-medium",children:[e("dashboard.bear"),": ",e("dashboard.scenarioValue.bear."+c.scenario.bear)]})]})]}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:e("dashboard.recommendationsTitle")}),c.recommendations&&0!==c.recommendations.length?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:c.recommendations.map(t=>{let a="dashboard.recommendations."+t.id,r="dashboard.recommendations."+t.id+"_desc",n=e(r)!==r?e(r):null;return(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:e(a)}),n&&(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:n}),t.tickers&&t.tickers.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-1.5 mt-2",children:t.tickers.map(e=>(0,s.jsx)("span",{className:"inline-flex items-center rounded-md bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-700",children:e},e))})]},t.id)})}):(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-6",children:e("dashboard.recommendationsEmpty")}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:e("dashboard.indicators")}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.indicators.map(r=>{let l="dashboard.indicatorTooltip."+r.key,d=e(l)!==l?e(l):null;return(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow-sm relative",onMouseEnter:()=>L(r.key),onMouseLeave:()=>L(null),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("span",{className:"font-medium",children:r.key}),(0,s.jsx)("span",{className:M(r.status),title:e("status."+r.status.toLowerCase()),"aria-label":e("status."+r.status.toLowerCase()),children:(0,s.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 20 20",children:(0,s.jsx)("circle",{cx:"10",cy:"10",r:"8",fill:"currentColor"})})})]}),null!=r.value&&(0,s.jsxs)("p",{className:"text-lg mt-1",children:[r.value,null!=r.ma21d&&(0,s.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",e("dashboard.ma21d"),": ",r.ma21d,")"]})]}),r.referenceText&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e("dashboard.referenceLabel")," ","es"===a?r.referenceText.replace(/\bzone\b/g,"zona").replace(/\bred\b/g,"rojo").replace(/\bgreen\b/g,"verde"):r.referenceText]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[W(r.trend)," ",e("trend."+r.trend.toLowerCase())]}),r.explain&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:t(r.explain)}),"UNKNOWN"===r.status&&"Data stale"===r.explain&&(0,s.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:e("dashboard.staleHint")}),e("dashboard.favorable."+r.key)!=="dashboard.favorable."+r.key&&(0,s.jsxs)("p",{className:"text-xs text-gray-600 mt-2 pt-2 border-t border-gray-100",children:[(0,s.jsx)("span",{className:"font-medium text-gray-700",children:e("dashboard.favorableLabel")})," ",e("dashboard.favorable."+r.key)]}),E===r.key&&d&&(0,s.jsx)("div",{className:"absolute z-20 left-0 right-0 bottom-full mb-1 p-3 text-xs text-left bg-gray-800 text-white rounded-lg shadow-lg pointer-events-none",children:d}),(0,s.jsx)(n.default,{href:"/indicators/".concat(r.key),className:"text-xs text-blue-600 mt-2 inline-block hover:underline",children:e("dashboard.viewHistory")})]},r.key)})}),0===c.indicators.length&&(0,s.jsxs)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-4 text-amber-800",children:[(0,s.jsx)("p",{className:"font-medium",children:e("dashboard.noIndicators")}),(0,s.jsx)("p",{className:"mt-1 text-sm",children:e("dashboard.noIndicatorsHint")}),(0,s.jsx)("p",{className:"mt-2 text-xs text-amber-700",children:e("dashboard.apiKeysHint")})]})]})}},6264:function(e,t,a){"use strict";var s;a.d(t,{AK:function(){return l},JB:function(){return m},Oj:function(){return o},cS:function(){return d},hE:function(){return i},j:function(){return c}});let r=null!==(s=a(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"";async function n(e){if(e.ok)return;let t=await e.text(),a=t||e.statusText;try{let e=JSON.parse(t);"string"==typeof(null==e?void 0:e.error)&&(a=e.error)}catch(e){}throw Error(a)}async function l(e){let t=e?"?timezone=".concat(encodeURIComponent(e)):"",a=await fetch("".concat(r,"/api/dashboard/today").concat(t));return await n(a),a.json()}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"30d",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1d",s=await fetch("".concat(r,"/api/indicators/").concat(encodeURIComponent(e),"/history?range=").concat(t,"&granularity=").concat(a));return await n(s),s.json()}async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"12w",t=await fetch("".concat(r,"/api/score/history?range=").concat(e));return await n(t),t.json()}async function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"30d",t=await fetch("".concat(r,"/api/alerts/history?range=").concat(e));return await n(t),t.json()}async function c(){let e=await fetch("".concat(r,"/api/rules"));return await n(e),e.json()}async function m(e){let t={};e&&(t["X-Cron-Secret"]=e);let a=await fetch("".concat("","/.netlify/functions/run-jobs"),{method:"POST",headers:t});if(401===a.status)throw Error("Cron secret required. Set CRON_SECRET in Netlify and enter it when prompted.");return await n(a),a.json().catch(()=>({ok:!0}))}}},function(e){e.O(0,[497,138,836,971,23,744],function(){return e(e.s=9140)}),_N_E=e.O()}]);